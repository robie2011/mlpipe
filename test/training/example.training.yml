name: myExampleModel
source:
  name: datasources.empa.EmpaCsvSourceAdapter
  pathToFile: /Users/robert.rajakone/repos/2019_p9/code/test/dsl/testinput.csv
  fields:
    - abc1 as temp1
    - abc2 as temp2

pipeline:
  - name: aggregators.Max
    sequence: 5
    generate:
    - inputField: temp1
      outputField: tempMax
    - inputField: temp2
      outputField: temp2Max
  - name: aggregators.Trend
    sequence: 5
    generate:
    - inputField: temp1
      outputField: tempTrend
    - inputField: temp2
      outputField: temp2Trend
  - name: aggregators.Min
    sequence: 5
    generate:
    - inputField: temp1
      outputField: tempMin
  - name: features.TimeFeatureExtractor
    extract: hour
    output_field: hourExtracted
  - name: processors.NanRemover


# validation: get sourceField information from pipeline
modelInput:
  predictionSourceFields:
    - temp2
    - tempMax
    - temp2Trend

  predictionTargetField: temp1

  # binary, class, regression
  predictionType: binary

  scale:
#    - name: scalers.MinMaxRangeScaler
#      range_start: 0
#      range_end: 7
#      fields: hourExtracted

    # note: sometimes scaler return a copy and sometimes inplace operation
    # ensure returned data is replaced in origin space

    # here configuration will be saved into database
    # and can be exported later
    #- name: sklearn.preprocessing.MinMaxScaler
    - name: sklearn.preprocessing.RobustScaler
      fields:
        - temp2
        - tempMax
        - temp2Trend

  #create3dSequence: 10
  shuffle: False
  ratioTestdata: .20


sequentialModel:
#  - name: keras.layers.LSTM
#    units: 100
#    activation: tanh
#    return_sequences: true
#  - name: keras.layers.LSTM
#    units: 50
#    activation: tanh
#    return_sequences: true
#  - name: keras.layers.LSTM
#    units: 20
#    activation: tanh
#    return_sequences: false
#  - name: keras.layers.Dense
#    units: 1
#    activation: sigmoid
  - name: keras.layers.Dense
    units: 30
    activation: tanh
  - name: keras.layers.Dense
    units: 10
    activation: tanh
  - name: keras.layers.Dense
    units: 1
    activation: sigmoid

modelCompile:
  loss: binary_crossentropy
  optimizer: Adam
  metrics:
    - accuracy

modelTraining:
  epochs: 100
  batch_size: 10
  repeat: 3

analyze:
  groupBy:
    - name: groupers.YearGrouper
    - name: groupers.MonthGrouper
  metrics:
    - name: aggregators.Max
    - name: aggregators.Min
    - name: aggregators.Percentile
      percentile: .75